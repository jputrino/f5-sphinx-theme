sudo: required
env:
  global:
  - DIST_REPO="f5-sphinx-theme"
  - USER_REPO=$(echo $TRAVIS_REPO_SLUG | cut -f -1 -d / )
  - BUILD_HTML_DIR=$TRAVIS_BUILD_DIR/test-deploy/docs/_build/html
  - $AWS_STAGING="https://d3s2z99mfhr69y.cloudfront.net"
services:
- docker
language: python
python:
- '2.7'
before_install:
- git config --global user.email "OpenStack_TravisCI@f5.com"
- git config --global user.name "f5-travisci"
install:
- gem install html-proofer
- pip install ./
script:
- htmlproofer --check_html --checks-to-ignore "LinkCheck,ImageCheck,ScriptCheck" --report_invalid_tags
  --report-script-embeds f5_sphinx_theme/
- test/theme-test.sh
deploy:
  matrix:
  - provider: s3
    skip_cleanup: true
    on:
      repo: $TRAVIS_REPO_SLUG
      all_branches: true
    access_key_id:
      secure: kt81AMmRezo56y0LWR7Uo1u4cil0skTMMt8DLZ0Lp3gUt7VPAq3XNRMpmi9WW8za80905SHZXNiakiwf2BWfosZka1O1t4Ja5RwZmAH5TcIaCzMRoOo1VDJtvMTtQweeIlrNjebGaxlPmc0+xYIUC1er0Hrlq07OvQZ2jQ9d4WNsVo1KsONy3MaKeTwhMpULr4HZjP6Mi9Llr7zdZzbfZtyNjml9BJzNsb3F/KE+O5Clumh0n2URpCLYoTjJLVvnii0kkKbAEBuxWGiZE0Ob8OnPthjTxVaNnN+vwCoi3/hBzvnxWV780/BSB4YhDkFcpMdotpVnhYP3IML/10NhLwJOHZSmORaqS5kOU1hbOzEdrD7arUZ4QV4RUOULDp5X3XUKA/vzczHOkQAX7sc38NV9HDVne7cSHNJ9KTfGOdhVlGyb0WN1YfjlQFPMm2H+RhbQ2tuxSvbIYPi3yKXb94oFW8MWJ8HqwX17Rll4YcHAjzHPqyZCp3aNBwI9FJQzZMBidm9qygUQPBdD0RIQ+hV+Zy6Fg5jdXTxXwIANEDlVCsRR+ieN8W683UMW2rQSdSoRszxwwe4XpMYRcrjq2MifOWzyod9Zqs7yBQ+uSZQ8Y89bSmf8tOwAhUihCcAoUX1kxqg8LqHHgEkNpyLeTK1WoVXktQRInUkWRz10O1A=
    secret_access_key:
      secure: P3I7jXqxCVEWxeojZU0VaNvis3ePBMxnPBLoJI0p4z6zKnzP4MuZ54ssXG3kSQL3EejEBdHzfpRQWSjGCczFv6TmjqJNr14lWR3/nqDSq5WtX6oHkZF0db0cyM3l8T3DqrHFzV5GsKaA+RR/tobS1inX7lYWOfrsq4DuXzo6onlhrKstSuetFnotz4iVHCFAFTD43I/Zo9+umvO6ZyLWKKjDTSjwH7sw6v5DvrkNHbu43QkOCzeabFOcPktUbKk5N32TbkVlzia4HIZ6Z8IwvCWXfm84zY8SniVhgS3bS2Buvv5kcjQcwSSy02gu7wFd5yBq4IbzLS0h24L5cIq+p0oUHtmDErnJJoecdvJ4/rR9xVMzwK/wf68SzH6nHPq7HAyQtiz0RBOnguOd0EfYm2QVeY7XM/66w6vZjVRRd76TJlK6nE76zvHfVTtT+0nyxbFn/ObfTKm/kdKhZNGTN/8vLHu+nlR9i6BjOak1hkFa9//zYjpiKC/pzUZ1widLot8I7TcQW8CnIXVIhoN23v7nAL5XkWagQvlHMcA43/jEsyrpCbi+pgrRK8AR1EuXAJshZ7oeKq3WfelaWFQjxFOtEDzACVnhxGyC91csCjrlGZVyYd0nPQa30iVQVoWndpR7hks8zXdCWiaTawlQpFfdeh+h0fWURzGCBsL0xEA=
    bucket: clouddocs.f5networks.net
    acl: authenticated_read
    local_dir: $BUILD_HTML_DIR
    upload_dir: $DIST_REPO/travis-builds/$USER_REPO/$TRAVIS_BUILD_NUMBER
  - provider: pypi
    user: "$PYPI_USER"
    password: "$PYPI_PASSWORD"
    server: https://pypi.python.org.pypi
    on:
      tags: true
    skip_cleanup: true

after_deploy:
  - echo "Docs published to:"
  - echo "${AWS_STAGING}/${DIST_REPO}/travis-builds/${USER_REPO}/${TRAVIS_BUILD_NUMBER}"



